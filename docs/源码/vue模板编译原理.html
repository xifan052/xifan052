<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vueæ¨¡æ¿ç¼–è¯‘åŸç† | è½æ—¥ä¸é²¸</title>
    <meta name="generator" content="VuePress 1.8.3">
    
    <meta name="description" content="æœ‰ä¸€å¤©æ²¡ä¸€å¤©çš„å‡çº§æ‰“æ€ª">
    
    <link rel="preload" href="/xifan052/assets/css/0.styles.3aec0134.css" as="style"><link rel="preload" href="/xifan052/assets/js/app.4adfbbdc.js" as="script"><link rel="preload" href="/xifan052/assets/js/4.2ae3d6d0.js" as="script"><link rel="preload" href="/xifan052/assets/js/1.b6076196.js" as="script"><link rel="preload" href="/xifan052/assets/js/19.1bdddbfb.js" as="script"><link rel="prefetch" href="/xifan052/assets/js/10.39e32a91.js"><link rel="prefetch" href="/xifan052/assets/js/11.73b7b4d7.js"><link rel="prefetch" href="/xifan052/assets/js/12.16b336a5.js"><link rel="prefetch" href="/xifan052/assets/js/13.27cfb3cd.js"><link rel="prefetch" href="/xifan052/assets/js/14.96cda819.js"><link rel="prefetch" href="/xifan052/assets/js/15.2b26aac4.js"><link rel="prefetch" href="/xifan052/assets/js/16.66b0c9a9.js"><link rel="prefetch" href="/xifan052/assets/js/17.f35490db.js"><link rel="prefetch" href="/xifan052/assets/js/18.267ffd3e.js"><link rel="prefetch" href="/xifan052/assets/js/2.366f5922.js"><link rel="prefetch" href="/xifan052/assets/js/20.8b236bb9.js"><link rel="prefetch" href="/xifan052/assets/js/21.d48481a9.js"><link rel="prefetch" href="/xifan052/assets/js/22.7640b341.js"><link rel="prefetch" href="/xifan052/assets/js/23.61302dfd.js"><link rel="prefetch" href="/xifan052/assets/js/24.f2c5350d.js"><link rel="prefetch" href="/xifan052/assets/js/25.6cfacdeb.js"><link rel="prefetch" href="/xifan052/assets/js/26.0c6b9d28.js"><link rel="prefetch" href="/xifan052/assets/js/27.4d659a39.js"><link rel="prefetch" href="/xifan052/assets/js/28.c9bf0652.js"><link rel="prefetch" href="/xifan052/assets/js/29.84b84c18.js"><link rel="prefetch" href="/xifan052/assets/js/30.59bba942.js"><link rel="prefetch" href="/xifan052/assets/js/31.8e1319a6.js"><link rel="prefetch" href="/xifan052/assets/js/32.88cb9898.js"><link rel="prefetch" href="/xifan052/assets/js/33.4b1f4c66.js"><link rel="prefetch" href="/xifan052/assets/js/34.51d2642e.js"><link rel="prefetch" href="/xifan052/assets/js/35.e213cc46.js"><link rel="prefetch" href="/xifan052/assets/js/36.89dafe45.js"><link rel="prefetch" href="/xifan052/assets/js/37.f2418079.js"><link rel="prefetch" href="/xifan052/assets/js/38.6236ea45.js"><link rel="prefetch" href="/xifan052/assets/js/39.ccd66f3f.js"><link rel="prefetch" href="/xifan052/assets/js/40.f9ce5c4c.js"><link rel="prefetch" href="/xifan052/assets/js/41.a2a2aa0f.js"><link rel="prefetch" href="/xifan052/assets/js/42.60b9f123.js"><link rel="prefetch" href="/xifan052/assets/js/43.5c0a4e0d.js"><link rel="prefetch" href="/xifan052/assets/js/44.7822b523.js"><link rel="prefetch" href="/xifan052/assets/js/45.491b734a.js"><link rel="prefetch" href="/xifan052/assets/js/46.bca355cd.js"><link rel="prefetch" href="/xifan052/assets/js/47.54e83d84.js"><link rel="prefetch" href="/xifan052/assets/js/5.e1b3bf99.js"><link rel="prefetch" href="/xifan052/assets/js/6.12ce358f.js"><link rel="prefetch" href="/xifan052/assets/js/7.d9da6cff.js"><link rel="prefetch" href="/xifan052/assets/js/8.60b1b885.js"><link rel="prefetch" href="/xifan052/assets/js/9.14402d71.js">
    <link rel="stylesheet" href="/xifan052/assets/css/0.styles.3aec0134.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-0e79056e><div data-v-0e79056e><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-0e79056e data-v-0e79056e><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-06dbc5d6 data-v-0e79056e data-v-0e79056e><h3 class="title" data-v-06dbc5d6 data-v-06dbc5d6>è½æ—¥ä¸é²¸</h3> <p class="description" data-v-06dbc5d6 data-v-06dbc5d6>æœ‰ä¸€å¤©æ²¡ä¸€å¤©çš„å‡çº§æ‰“æ€ª</p> <label id="box" class="inputBox" data-v-06dbc5d6 data-v-06dbc5d6><input type="password" value="" data-v-06dbc5d6> <span data-v-06dbc5d6>Konck! Knock!</span> <button data-v-06dbc5d6>OK</button></label> <div class="footer" data-v-06dbc5d6 data-v-06dbc5d6><span data-v-06dbc5d6><i class="iconfont reco-theme" data-v-06dbc5d6></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-06dbc5d6>vuePress-theme-reco</a></span> <span data-v-06dbc5d6><i class="iconfont reco-copyright" data-v-06dbc5d6></i> <a data-v-06dbc5d6><!---->
          Â Â 
          <!---->
          2022
        </a></span></div></div> <div class="hide" data-v-0e79056e><header class="navbar" data-v-0e79056e><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/xifan052/" class="home-link router-link-active"><img src="/xifan052/avatar.jpg" alt="è½æ—¥ä¸é²¸" class="logo"> <span class="site-name">è½æ—¥ä¸é²¸</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/xifan052/" class="nav-link"><i class="undefined"></i>
  é¦–é¡µ
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-api"></i>
      æ»¡æ»¡çš„æŠ€æœ¯
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/xifan052/categories/All/" class="nav-link"><i class="undefined"></i>
  All
</a></li><li class="dropdown-item"><!----> <a href="/xifan052/categories/JavaScriptæ·±å…¥/" class="nav-link"><i class="undefined"></i>
  JavaScriptæ·±å…¥
</a></li><li class="dropdown-item"><!----> <a href="/xifan052/categories/ä¸ªäººæˆé•¿/" class="nav-link"><i class="undefined"></i>
  ä¸ªäººæˆé•¿
</a></li><li class="dropdown-item"><!----> <a href="/xifan052/categories/æºç /" class="nav-link"><i class="undefined"></i>
  æºç 
</a></li><li class="dropdown-item"><!----> <a href="/xifan052/categories/Vue/" class="nav-link"><i class="undefined"></i>
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/xifan052/categories/é¢è¯•é¢˜/" class="nav-link"><i class="undefined"></i>
  é¢è¯•é¢˜
</a></li><li class="dropdown-item"><!----> <a href="/xifan052/categories/JSåŸºç¡€/" class="nav-link"><i class="undefined"></i>
  JSåŸºç¡€
</a></li><li class="dropdown-item"><!----> <a href="/xifan052/categories/CSSä¸–ç•Œ/" class="nav-link"><i class="undefined"></i>
  CSSä¸–ç•Œ
</a></li><li class="dropdown-item"><!----> <a href="/xifan052/categories/æµè§ˆå™¨/" class="nav-link"><i class="undefined"></i>
  æµè§ˆå™¨
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      å¸¸ç”¨å·¥å…·
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://tinypng.com" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  TinyPNG-å›¾ç‰‡å‹ç¼©
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://chrome.zzzmh.cn/#/index" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Chromeæ‰©å±•æ’ä»¶
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.helloworld.net/html2md" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  htmlè½¬md
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://naotu.baidu.com/home" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  ç™¾åº¦åœ¨çº¿è„‘å›¾
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://smallpdf.com/pdf-tools" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  PDFè½¬æ¢å·¥å…·
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.emojiall.com/zh-hans" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Emojiå¤§å…¨
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      æç¥moğŸŸ
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.yikm.net/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  å°éœ¸ç‹è¡—æœº
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://slither.io/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  è´ªåƒè›‡å¤§ä½œæˆ˜
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://ac.yunyoujun.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  ä¾¿æºå°ç©ºè°ƒ
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://fan.elpsy.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  å¤æ—¥æ¸…å‡‰å°é£æ‰‡
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://gitee.com/xifan_t" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/xifan052" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/2313028196632446" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  æ˜é‡‘
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-0e79056e></div> <aside class="sidebar" data-v-0e79056e><div class="personal-info-wrapper" data-v-ad235a34 data-v-0e79056e><!----> <!----> <div class="num" data-v-ad235a34><div data-v-ad235a34><h3 data-v-ad235a34>35</h3> <h6 data-v-ad235a34>æ–‡ç« </h6></div> <div data-v-ad235a34><h3 data-v-ad235a34>0</h3> <h6 data-v-ad235a34>æ ‡ç­¾</h6></div></div> <ul class="social-links" data-v-ad235a34></ul> <hr data-v-ad235a34></div> <nav class="nav-links"><div class="nav-item"><a href="/xifan052/" class="nav-link"><i class="undefined"></i>
  é¦–é¡µ
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-api"></i>
      æ»¡æ»¡çš„æŠ€æœ¯
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/xifan052/categories/All/" class="nav-link"><i class="undefined"></i>
  All
</a></li><li class="dropdown-item"><!----> <a href="/xifan052/categories/JavaScriptæ·±å…¥/" class="nav-link"><i class="undefined"></i>
  JavaScriptæ·±å…¥
</a></li><li class="dropdown-item"><!----> <a href="/xifan052/categories/ä¸ªäººæˆé•¿/" class="nav-link"><i class="undefined"></i>
  ä¸ªäººæˆé•¿
</a></li><li class="dropdown-item"><!----> <a href="/xifan052/categories/æºç /" class="nav-link"><i class="undefined"></i>
  æºç 
</a></li><li class="dropdown-item"><!----> <a href="/xifan052/categories/Vue/" class="nav-link"><i class="undefined"></i>
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/xifan052/categories/é¢è¯•é¢˜/" class="nav-link"><i class="undefined"></i>
  é¢è¯•é¢˜
</a></li><li class="dropdown-item"><!----> <a href="/xifan052/categories/JSåŸºç¡€/" class="nav-link"><i class="undefined"></i>
  JSåŸºç¡€
</a></li><li class="dropdown-item"><!----> <a href="/xifan052/categories/CSSä¸–ç•Œ/" class="nav-link"><i class="undefined"></i>
  CSSä¸–ç•Œ
</a></li><li class="dropdown-item"><!----> <a href="/xifan052/categories/æµè§ˆå™¨/" class="nav-link"><i class="undefined"></i>
  æµè§ˆå™¨
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      å¸¸ç”¨å·¥å…·
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://tinypng.com" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  TinyPNG-å›¾ç‰‡å‹ç¼©
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://chrome.zzzmh.cn/#/index" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Chromeæ‰©å±•æ’ä»¶
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.helloworld.net/html2md" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  htmlè½¬md
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://naotu.baidu.com/home" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  ç™¾åº¦åœ¨çº¿è„‘å›¾
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://smallpdf.com/pdf-tools" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  PDFè½¬æ¢å·¥å…·
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.emojiall.com/zh-hans" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Emojiå¤§å…¨
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      æç¥moğŸŸ
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.yikm.net/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  å°éœ¸ç‹è¡—æœº
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://slither.io/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  è´ªåƒè›‡å¤§ä½œæˆ˜
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://ac.yunyoujun.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  ä¾¿æºå°ç©ºè°ƒ
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://fan.elpsy.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  å¤æ—¥æ¸…å‡‰å°é£æ‰‡
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://gitee.com/xifan_t" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/xifan052" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/2313028196632446" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  æ˜é‡‘
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-06dbc5d6 data-v-0e79056e><h3 class="title" data-v-06dbc5d6 data-v-06dbc5d6>Vueæ¨¡æ¿ç¼–è¯‘åŸç†</h3> <!----> <label id="box" class="inputBox" data-v-06dbc5d6 data-v-06dbc5d6><input type="password" value="" data-v-06dbc5d6> <span data-v-06dbc5d6>Konck! Knock!</span> <button data-v-06dbc5d6>OK</button></label> <div class="footer" data-v-06dbc5d6 data-v-06dbc5d6><span data-v-06dbc5d6><i class="iconfont reco-theme" data-v-06dbc5d6></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-06dbc5d6>vuePress-theme-reco</a></span> <span data-v-06dbc5d6><i class="iconfont reco-copyright" data-v-06dbc5d6></i> <a data-v-06dbc5d6><!---->
          Â Â 
          <!---->
          2022
        </a></span></div></div> <div data-v-0e79056e><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">Vueæ¨¡æ¿ç¼–è¯‘åŸç†</h1> <div data-v-27b367dd><!----> <i class="iconfont reco-date" data-v-27b367dd><span data-v-27b367dd>2020-8-21</span></i> <!----> <!----></div></div> <div class="theme-reco-content content__default"><blockquote><p>æ¥æºäºå¾®ä¿¡å…¬ä¼—å·ï¼š<a href="https://mp.weixin.qq.com/s/lGgVgW1K-lVf7ypniH7tmg" target="_blank" rel="noopener noreferrer">æ›´äº†ä¸èµ·çš„å‰ç«¯<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ï¼›</p></blockquote> <h2 id="å†™åœ¨å¼€å¤´"><a href="#å†™åœ¨å¼€å¤´" class="header-anchor">#</a> å†™åœ¨å¼€å¤´</h2> <p>å†™è¿‡ Vue çš„åŒå­¦è‚¯å®šä½“éªŒè¿‡ï¼Œ <code>.vue</code> è¿™ç§å•æ–‡ä»¶ç»„ä»¶æœ‰å¤šä¹ˆæ–¹ä¾¿ã€‚ä½†æ˜¯æˆ‘ä»¬ä¹ŸçŸ¥é“ï¼ŒVue åº•å±‚æ˜¯é€šè¿‡è™šæ‹Ÿ DOM æ¥è¿›è¡Œæ¸²æŸ“çš„ï¼Œé‚£ä¹ˆ <code>.vue</code> æ–‡ä»¶çš„æ¨¡æ¿åˆ°åº•æ˜¯æ€ä¹ˆè½¬æ¢æˆè™šæ‹Ÿ DOM çš„å‘¢ï¼Ÿè¿™ä¸€å—å¯¹æˆ‘æ¥è¯´ä¸€ç›´æ˜¯ä¸ªé»‘ç›’ï¼Œä¹‹å‰ä¹Ÿæ²¡æœ‰æ·±å…¥ç ”ç©¶è¿‡ï¼Œä»Šå¤©æ‰“ç®—ä¸€æ¢ç©¶ç«Ÿã€‚</p> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/521e308ad2d64e2ab9c0b87948c5d6a3~tplv-k3u1fbpfcp-zoom-1.image" alt=" "></p> <center>Virtual Dom</center> <p>Vue 3 å‘å¸ƒä¹‹åï¼Œæœ¬æ¥æƒ³ç€ç›´æ¥çœ‹çœ‹ Vue 3 çš„æ¨¡æ¿ç¼–è¯‘ï¼Œä½†æ˜¯æˆ‘æ‰“å¼€ Vue 3 æºç çš„æ—¶å€™ï¼Œå‘ç°æˆ‘å¥½åƒè¿ Vue 2 æ˜¯æ€ä¹ˆç¼–è¯‘æ¨¡æ¿çš„éƒ½ä¸çŸ¥é“ã€‚ä»å°é²è¿…å°±å‘Šè¯‰æˆ‘ä»¬ï¼Œä¸èƒ½ä¸€å£åƒæˆä¸€ä¸ªèƒ–å­ï¼Œé‚£æˆ‘åªèƒ½å›å¤´çœ‹çœ‹ Vue 2 çš„æ¨¡æ¿ç¼–è¯‘æºç ï¼Œè‡³äº Vue 3 å°±ç•™åˆ°æ­£å¼å‘å¸ƒçš„æ—¶å€™å†çœ‹ã€‚</p> <h2 id="vue-çš„ç‰ˆæœ¬"><a href="#vue-çš„ç‰ˆæœ¬" class="header-anchor">#</a> Vue çš„ç‰ˆæœ¬</h2> <p>å¾ˆå¤šäººä½¿ç”¨ Vue çš„æ—¶å€™ï¼Œéƒ½æ˜¯ç›´æ¥é€šè¿‡ vue-cli ç”Ÿæˆçš„æ¨¡æ¿ä»£ç ï¼Œå¹¶ä¸çŸ¥é“ Vue å…¶å®æä¾›äº†ä¸¤ä¸ªæ„å»ºç‰ˆæœ¬ã€‚</p> <ul><li><code>vue.js</code>ï¼šå®Œæ•´ç‰ˆæœ¬ï¼ŒåŒ…å«äº†æ¨¡æ¿ç¼–è¯‘çš„èƒ½åŠ›ï¼›</li> <li><code>vue.runtime.js</code>ï¼šè¿è¡Œæ—¶ç‰ˆæœ¬ï¼Œä¸æä¾›æ¨¡æ¿ç¼–è¯‘èƒ½åŠ›ï¼Œéœ€è¦é€šè¿‡ vue-loader è¿›è¡Œæå‰ç¼–è¯‘ã€‚</li></ul> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bb8040d204d442efa266ddec31faa5bf~tplv-k3u1fbpfcp-zoom-1.image" alt=" "></p> <center>Vue ä¸åŒæ„å»ºç‰ˆæœ¬</center> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c696fca00d124667bec1c06f0da6e706~tplv-k3u1fbpfcp-zoom-1.image" alt=" "></p> <center>å®Œæ•´ç‰ˆä¸è¿è¡Œæ—¶ç‰ˆåŒºåˆ«</center> <p>ç®€å•æ¥è¯´ï¼Œå°±æ˜¯å¦‚æœä½ ç”¨äº† vue-loader ï¼Œå°±å¯ä»¥ä½¿ç”¨ <code>vue.runtime.min.js</code>ï¼Œå°†æ¨¡æ¿ç¼–è¯‘çš„è¿‡ç¨‹äº¤è¿‡ vue-loaderï¼Œå¦‚æœä½ æ˜¯åœ¨æµè§ˆå™¨ä¸­ç›´æ¥é€šè¿‡ <code>script</code> æ ‡ç­¾å¼•å…¥ Vueï¼Œéœ€è¦ä½¿ç”¨ <code>vue.min.js</code>ï¼Œè¿è¡Œçš„æ—¶å€™ç¼–è¯‘æ¨¡æ¿ã€‚</p> <h2 id="ç¼–è¯‘å…¥å£"><a href="#ç¼–è¯‘å…¥å£" class="header-anchor">#</a> ç¼–è¯‘å…¥å£</h2> <p>äº†è§£äº† Vue çš„ç‰ˆæœ¬ï¼Œæˆ‘ä»¬çœ‹çœ‹ Vue å®Œæ•´ç‰ˆçš„å…¥å£æ–‡ä»¶ï¼ˆ<code>src/platforms/web/entry-runtime-with-compiler.js</code>ï¼‰ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// çœç•¥äº†éƒ¨åˆ†ä»£ç ï¼Œåªä¿ç•™äº†å…³é”®éƒ¨åˆ†</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> compileToFunctions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./compiler/index'</span>

<span class="token keyword">const</span> mount <span class="token operator">=</span> <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$mount
<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$mount</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$options

  <span class="token comment">// å¦‚æœæ²¡æœ‰ render æ–¹æ³•ï¼Œåˆ™è¿›è¡Œ template ç¼–è¯‘</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>options<span class="token punctuation">.</span>render<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> template <span class="token operator">=</span> options<span class="token punctuation">.</span>template
    <span class="token keyword">if</span> <span class="token punctuation">(</span>template<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// è°ƒç”¨ compileToFunctionsï¼Œç¼–è¯‘ templateï¼Œå¾—åˆ° render æ–¹æ³•</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> render<span class="token punctuation">,</span> staticRenderFns <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">compileToFunctions</span><span class="token punctuation">(</span>
        template<span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          shouldDecodeNewlines<span class="token punctuation">,</span>
          shouldDecodeNewlinesForHref<span class="token punctuation">,</span>
          <span class="token literal-property property">delimiters</span><span class="token operator">:</span> options<span class="token punctuation">.</span>delimiters<span class="token punctuation">,</span>
          <span class="token literal-property property">comments</span><span class="token operator">:</span> options<span class="token punctuation">.</span>comments<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">this</span>
      <span class="token punctuation">)</span>
      <span class="token comment">// è¿™é‡Œçš„ render æ–¹æ³•å°±æ˜¯ç”Ÿæˆç”Ÿæˆè™šæ‹Ÿ DOM çš„æ–¹æ³•</span>
      options<span class="token punctuation">.</span>render <span class="token operator">=</span> render
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token function">mount</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> el<span class="token punctuation">,</span> hydrating<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å†çœ‹çœ‹ <code>./compiler/index</code> æ–‡ä»¶çš„ <code>compileToFunctions</code> æ–¹æ³•ä»ä½•è€Œæ¥ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> baseOptions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./options'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createCompiler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'compiler/index'</span>

<span class="token comment">// é€šè¿‡ createCompiler æ–¹æ³•ç”Ÿæˆç¼–è¯‘å‡½æ•°</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> compile<span class="token punctuation">,</span> compileToFunctions <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">createCompiler</span><span class="token punctuation">(</span>baseOptions<span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> compile<span class="token punctuation">,</span> compileToFunctions <span class="token punctuation">}</span>
</code></pre></div><p>åç»­çš„ä¸»è¦é€»è¾‘éƒ½åœ¨ <code>compiler</code> æ¨¡å—ä¸­ï¼Œè¿™ä¸€å—æœ‰äº›ç»•ï¼Œå› ä¸ºæœ¬æ–‡ä¸æ˜¯åšæºç åˆ†æï¼Œå°±ä¸è´´æ•´æ®µæºç äº†ã€‚ç®€å•çœ‹çœ‹è¿™ä¸€æ®µçš„é€»è¾‘æ˜¯æ€ä¹ˆæ ·çš„ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createCompiler</span><span class="token punctuation">(</span><span class="token parameter">baseOptions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">baseCompile</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">template<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// è§£æ htmlï¼Œè½¬åŒ–ä¸º ast</span>
    <span class="token keyword">const</span> ast <span class="token operator">=</span> <span class="token function">parse</span><span class="token punctuation">(</span>template<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span>
    <span class="token comment">// ä¼˜åŒ– astï¼Œæ ‡è®°é™æ€èŠ‚ç‚¹</span>
    <span class="token function">optimize</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
    <span class="token comment">// å°† ast è½¬åŒ–ä¸ºå¯æ‰§è¡Œä»£ç </span>
    <span class="token keyword">const</span> code <span class="token operator">=</span> <span class="token function">generate</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      ast<span class="token punctuation">,</span>
      <span class="token literal-property property">render</span><span class="token operator">:</span> code<span class="token punctuation">.</span>render<span class="token punctuation">,</span>
      <span class="token literal-property property">staticRenderFns</span><span class="token operator">:</span> code<span class="token punctuation">.</span>staticRenderFns<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> <span class="token function-variable function">compile</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">template<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> tips <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">const</span> errors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment">// æ”¶é›†ç¼–è¯‘è¿‡ç¨‹ä¸­çš„é”™è¯¯ä¿¡æ¯</span>
    options<span class="token punctuation">.</span><span class="token function-variable function">warn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span> tip</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token punctuation">;</span><span class="token punctuation">(</span>tip <span class="token operator">?</span> tips <span class="token operator">:</span> errors<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ç¼–è¯‘</span>
    <span class="token keyword">const</span> compiled <span class="token operator">=</span> <span class="token function">baseCompile</span><span class="token punctuation">(</span>template<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
    compiled<span class="token punctuation">.</span>errors <span class="token operator">=</span> errors
    compiled<span class="token punctuation">.</span>tips <span class="token operator">=</span> tips

    <span class="token keyword">return</span> compiled
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> <span class="token function-variable function">createCompileToFunctionFn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// ç¼–è¯‘ç¼“å­˜</span>
    <span class="token keyword">const</span> cache <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">template<span class="token punctuation">,</span> options<span class="token punctuation">,</span> vm</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// å·²ç¼–è¯‘æ¨¡æ¿ç›´æ¥èµ°ç¼“å­˜</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>cache<span class="token punctuation">[</span>template<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> cache<span class="token punctuation">[</span>template<span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">const</span> compiled <span class="token operator">=</span> <span class="token function">compile</span><span class="token punctuation">(</span>template<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> compiled<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    compile<span class="token punctuation">,</span>
    <span class="token literal-property property">compileToFunctions</span><span class="token operator">:</span> <span class="token function">createCompileToFunctionFn</span><span class="token punctuation">(</span>compile<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="ä¸»æµç¨‹"><a href="#ä¸»æµç¨‹" class="header-anchor">#</a> ä¸»æµç¨‹</h2> <p>å¯ä»¥çœ‹åˆ°ä¸»è¦çš„ç¼–è¯‘é€»è¾‘åŸºæœ¬éƒ½åœ¨ <code>baseCompile</code> æ–¹æ³•å†…ï¼Œä¸»è¦åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š</p> <ol><li>æ¨¡æ¿ç¼–è¯‘ï¼Œå°†æ¨¡æ¿ä»£ç è½¬åŒ–ä¸º ASTï¼›</li> <li>ä¼˜åŒ– ASTï¼Œæ–¹ä¾¿åç»­è™šæ‹Ÿ DOM æ›´æ–°ï¼›</li> <li>ç”Ÿæˆä»£ç ï¼Œå°† AST è½¬åŒ–ä¸ºå¯æ‰§è¡Œçš„ä»£ç ï¼›</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">baseCompile</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">template<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// è§£æ htmlï¼Œè½¬åŒ–ä¸º ast</span>
  <span class="token keyword">const</span> ast <span class="token operator">=</span> <span class="token function">parse</span><span class="token punctuation">(</span>template<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span>
  <span class="token comment">// ä¼˜åŒ– astï¼Œæ ‡è®°é™æ€èŠ‚ç‚¹</span>
  <span class="token function">optimize</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
  <span class="token comment">// å°† ast è½¬åŒ–ä¸ºå¯æ‰§è¡Œä»£ç </span>
  <span class="token keyword">const</span> code <span class="token operator">=</span> <span class="token function">generate</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    ast<span class="token punctuation">,</span>
    <span class="token literal-property property">render</span><span class="token operator">:</span> code<span class="token punctuation">.</span>render<span class="token punctuation">,</span>
    <span class="token literal-property property">staticRenderFns</span><span class="token operator">:</span> code<span class="token punctuation">.</span>staticRenderFns<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="parse"><a href="#parse" class="header-anchor">#</a> parse</h3> <h3 id="ast"><a href="#ast" class="header-anchor">#</a> AST</h3> <p>é¦–å…ˆçœ‹åˆ° parse æ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„ä¸»è¦ä½œç”¨å°±æ˜¯è§£æ HTMLï¼Œå¹¶è½¬åŒ–ä¸º ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰ï¼Œæ¥è§¦è¿‡ ESLintã€Babel çš„åŒå­¦è‚¯å®šå¯¹ AST ä¸é™Œç”Ÿï¼Œæˆ‘ä»¬å¯ä»¥å…ˆçœ‹çœ‹ç»è¿‡ parse ä¹‹åçš„ AST é•¿ä»€ä¹ˆæ ·ã€‚</p> <p>ä¸‹é¢æ˜¯ä¸€æ®µæ™®æ™®é€šé€šçš„ Vue æ¨¡æ¿ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">el</span><span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div&gt; &lt;h2 v-if=&quot;message&quot;&gt;{{message}}&lt;/h2&gt; &lt;button @click=&quot;showName&quot;&gt;showName&lt;/button&gt; &lt;/div&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'shenfq'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'Hello Vue!'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>ç»è¿‡ parse ä¹‹åçš„ ASTï¼š
<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0e03e06314804266a4d083792466b47d~tplv-k3u1fbpfcp-zoom-1.image" alt=" "></p> <center>Template AST</center> <p>AST ä¸ºä¸€ä¸ªæ ‘å½¢ç»“æ„çš„å¯¹è±¡ï¼Œæ¯ä¸€å±‚è¡¨ç¤ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œç¬¬ä¸€å±‚å°±æ˜¯ <code>div</code>ï¼ˆ<code>tag: &quot;div&quot;</code>ï¼‰ã€‚<code>div</code> çš„å­èŠ‚ç‚¹éƒ½åœ¨ children å±æ€§ä¸­ï¼Œåˆ†åˆ«æ˜¯ <code>h2</code> æ ‡ç­¾ã€ç©ºè¡Œã€<code>button</code> æ ‡ç­¾ã€‚æˆ‘ä»¬è¿˜å¯ä»¥æ³¨æ„åˆ°æœ‰ä¸€ä¸ªç”¨æ¥æ ‡è®°èŠ‚ç‚¹ç±»å‹çš„å±æ€§ï¼štypeï¼Œè¿™é‡Œ <code>div</code> çš„ type ä¸º 1ï¼Œè¡¨ç¤ºæ˜¯ä¸€ä¸ªå…ƒç´ èŠ‚ç‚¹ï¼Œtype ä¸€å…±æœ‰ä¸‰ç§ç±»å‹ï¼š</p> <ol><li>å…ƒç´ èŠ‚ç‚¹ï¼›</li> <li>è¡¨è¾¾å¼ï¼›</li> <li>æ–‡æœ¬ï¼›
åœ¨ <code>h2</code> å’Œ <code>button</code> æ ‡ç­¾ä¹‹é—´çš„ç©ºè¡Œå°±æ˜¯ type ä¸º 3 çš„æ–‡æœ¬èŠ‚ç‚¹ï¼Œè€Œ h2 æ ‡ç­¾ä¸‹å°±æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼èŠ‚ç‚¹ã€‚</li></ol> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4833cae795d84f94805c6dbf13f19391~tplv-k3u1fbpfcp-zoom-1.image" alt=" "></p> <center>èŠ‚ç‚¹ç±»å‹</center> <h3 id="è§£æ-html"><a href="#è§£æ-html" class="header-anchor">#</a> è§£æ HTML</h3> <p>parse çš„æ•´ä½“é€»è¾‘è¾ƒä¸ºå¤æ‚ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆç®€åŒ–ä¸€ä¸‹ä»£ç ï¼Œçœ‹çœ‹ parse çš„æµç¨‹ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> parseHTML <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./html-parser'</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">parse</span><span class="token punctuation">(</span><span class="token parameter">template<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> root
  <span class="token function">parseHTML</span><span class="token punctuation">(</span>template<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token comment">// some options...</span>
    <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// è§£æåˆ°æ ‡ç­¾ä½ç½®å¼€å§‹çš„å›è°ƒ</span>
    <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// è§£æåˆ°æ ‡ç­¾ä½ç½®ç»“æŸçš„å›è°ƒ</span>
    <span class="token function">chars</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// è§£æåˆ°æ–‡æœ¬æ—¶çš„å›è°ƒ</span>
    <span class="token function">comment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// è§£æåˆ°æ³¨é‡Šæ—¶çš„å›è°ƒ</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> root
<span class="token punctuation">}</span>
</code></pre></div><p>å¯ä»¥çœ‹åˆ° parse ä¸»è¦é€šè¿‡ parseHTML è¿›è¡Œå·¥ä½œï¼Œè¿™ä¸ª parseHTML æœ¬èº«æ¥è‡ªäºå¼€æºåº“ï¼šsimple html parserï¼Œåªä¸è¿‡ç»è¿‡äº† Vue å›¢é˜Ÿçš„ä¸€äº›ä¿®æ”¹ï¼Œä¿®å¤äº†ç›¸å…³ issueã€‚</p> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0ab5610884b3447dae75d282acb48011~tplv-k3u1fbpfcp-zoom-1.image" alt="èŠ‚ç‚¹ç±»å‹">
HTML parser</p> <p>ä¸‹é¢æˆ‘ä»¬ä¸€èµ·æ¥ç†ä¸€ç† parseHTML çš„é€»è¾‘ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">parseHTML</span><span class="token punctuation">(</span><span class="token parameter">html<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">let</span> last<span class="token punctuation">,</span> lastTag
  <span class="token keyword">const</span> stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>html<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    last <span class="token operator">=</span> html
    <span class="token keyword">let</span> textEnd <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'&lt;'</span><span class="token punctuation">)</span>

    <span class="token comment">// &quot;&lt;&quot; å­—ç¬¦åœ¨å½“å‰ html å­—ç¬¦ä¸²å¼€å§‹ä½ç½®</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>textEnd <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 1ã€åŒ¹é…åˆ°æ³¨é‡Š: &lt;!-- --&gt;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^&lt;!\--</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> commentEnd <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'--&gt;'</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>commentEnd <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// è°ƒç”¨ options.comment å›è°ƒï¼Œä¼ å…¥æ³¨é‡Šå†…å®¹</span>
          options<span class="token punctuation">.</span><span class="token function">comment</span><span class="token punctuation">(</span>html<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> commentEnd<span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token comment">// è£åˆ‡æ‰æ³¨é‡Šéƒ¨åˆ†</span>
          <span class="token function">advance</span><span class="token punctuation">(</span>commentEnd <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">)</span>
          <span class="token keyword">continue</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 2ã€åŒ¹é…åˆ°æ¡ä»¶æ³¨é‡Š: &lt;![if !IE]&gt;  &lt;![endif]&gt;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^&lt;!\[</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ... é€»è¾‘ä¸åŒ¹é…åˆ°æ³¨é‡Šç±»ä¼¼</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 3ã€åŒ¹é…åˆ° Doctype: &lt;!DOCTYPE html&gt;</span>
      <span class="token keyword">const</span> doctypeMatch <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^&lt;!DOCTYPE [^&gt;]+&gt;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>doctypeMatch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ... é€»è¾‘ä¸åŒ¹é…åˆ°æ³¨é‡Šç±»ä¼¼</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 4ã€åŒ¹é…åˆ°ç»“æŸæ ‡ç­¾: &lt;/div&gt;</span>
      <span class="token keyword">const</span> endTagMatch <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>endTag<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>endTagMatch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 5ã€åŒ¹é…åˆ°å¼€å§‹æ ‡ç­¾: &lt;div&gt;</span>
      <span class="token keyword">const</span> startTagMatch <span class="token operator">=</span> <span class="token function">parseStartTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>startTagMatch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// &quot;&lt;&quot; å­—ç¬¦åœ¨å½“å‰ html å­—ç¬¦ä¸²ä¸­é—´ä½ç½®</span>
    <span class="token keyword">let</span> text<span class="token punctuation">,</span> rest<span class="token punctuation">,</span> next
    <span class="token keyword">if</span> <span class="token punctuation">(</span>textEnd <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// æå–ä¸­é—´å­—ç¬¦</span>
      rest <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>textEnd<span class="token punctuation">)</span>
      <span class="token comment">// è¿™ä¸€éƒ¨åˆ†å½“æˆæ–‡æœ¬å¤„ç†</span>
      text <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> textEnd<span class="token punctuation">)</span>
      <span class="token function">advance</span><span class="token punctuation">(</span>textEnd<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// &quot;&lt;&quot; å­—ç¬¦åœ¨å½“å‰ html å­—ç¬¦ä¸²ä¸­ä¸å­˜åœ¨</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>textEnd <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      text <span class="token operator">=</span> html
      html <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// å¦‚æœå­˜åœ¨ text æ–‡æœ¬</span>
    <span class="token comment">// è°ƒç”¨ options.chars å›è°ƒï¼Œä¼ å…¥ text æ–‡æœ¬</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>chars <span class="token operator">&amp;&amp;</span> text<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// å­—ç¬¦ç›¸å…³å›è°ƒ</span>
      options<span class="token punctuation">.</span><span class="token function">chars</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// å‘å‰æ¨è¿›ï¼Œè£åˆ‡ html</span>
  <span class="token keyword">function</span> <span class="token function">advance</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    index <span class="token operator">+=</span> n
    html <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ä¸Šè¿°ä»£ç ä¸ºç®€åŒ–åçš„ parseHTMLï¼Œ<code>while</code> å¾ªç¯ä¸­æ¯æ¬¡æˆªå–ä¸€æ®µ html æ–‡æœ¬ï¼Œç„¶åé€šè¿‡æ­£åˆ™åˆ¤æ–­æ–‡æœ¬çš„ç±»å‹è¿›è¡Œå¤„ç†ï¼Œè¿™å°±ç±»ä¼¼äºç¼–è¯‘åŸç†ä¸­å¸¸ç”¨çš„æœ‰é™çŠ¶æ€æœºã€‚æ¯æ¬¡æ‹¿åˆ° <code>&quot;&lt;&quot;</code> å­—ç¬¦å‰åçš„æ–‡æœ¬ï¼Œ<code>&quot;&lt;&quot;</code> å­—ç¬¦å‰çš„å°±å½“åšæ–‡æœ¬å¤„ç†ï¼Œ<code>&quot;&lt;&quot;</code> å­—ç¬¦åçš„é€šè¿‡æ­£åˆ™åˆ¤æ–­ï¼Œå¯æ¨ç®—å‡ºæœ‰é™çš„å‡ ç§çŠ¶æ€ã€‚</p> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dbed3a4c2c924493812122510a579e3f~tplv-k3u1fbpfcp-zoom-1.image" alt=" "></p> <center>html çš„å‡ ç§çŠ¶æ€</center> <p>å…¶ä»–çš„é€»è¾‘å¤„ç†éƒ½ä¸å¤æ‚ï¼Œä¸»è¦æ˜¯å¼€å§‹æ ‡ç­¾ä¸ç»“æŸæ ‡ç­¾ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹å…³äºå¼€å§‹æ ‡ç­¾ä¸ç»“æŸæ ‡ç­¾ç›¸å…³çš„æ­£åˆ™ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> ncname <span class="token operator">=</span> <span class="token string">'[a-zA-Z_][\\w\\-\\.]*'</span>
<span class="token keyword">const</span> qnameCapture <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">((?:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ncname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\\:)?</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ncname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span>
<span class="token keyword">const</span> startTagOpen <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">^&lt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>qnameCapture<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
</code></pre></div><p>è¿™æ®µæ­£åˆ™çœ‹èµ·æ¥å¾ˆé•¿ï¼Œä½†æ˜¯ç†æ¸…ä¹‹åä¹Ÿä¸æ˜¯å¾ˆéš¾ã€‚è¿™é‡Œæ¨èä¸€ä¸ªæ­£åˆ™å¯è§†åŒ–å·¥å…·ã€‚æˆ‘ä»¬åˆ°å·¥å…·ä¸Šçœ‹çœ‹ startTagOpenï¼š</p> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3c44a1d053fd481da3d793b5e549a688~tplv-k3u1fbpfcp-zoom-1.image" alt=" "></p> <center>startTagOpen</center> <p>è¿™é‡Œæ¯”è¾ƒç–‘æƒ‘çš„ç‚¹å°±æ˜¯ä¸ºä»€ä¹ˆ tagName ä¼šå­˜åœ¨ <code>:</code>ï¼Œè¿™ä¸ªæ˜¯ XML çš„ å‘½åç©ºé—´ï¼Œç°åœ¨å·²ç»å¾ˆå°‘ä½¿ç”¨äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å¿½ç•¥ï¼Œæ‰€ä»¥æˆ‘ä»¬ç®€åŒ–ä¸€ä¸‹è¿™ä¸ªæ­£åˆ™ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> ncname <span class="token operator">=</span> <span class="token string">'[a-zA-Z_][\\w\\-\\.]_'</span>
<span class="token keyword">const</span> startTagOpen <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">^&lt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ncname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token keyword">const</span> startTagClose <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\s_(\/?)&gt;</span><span class="token regex-delimiter">/</span></span>
<span class="token keyword">const</span> endTag <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">^&lt;\\/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ncname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">[^&gt;]*&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
</code></pre></div><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d8aca6d951244f708d981c5e9e4cc961~tplv-k3u1fbpfcp-zoom-1.image" alt=" "></p> <center>startTagOpen</center> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0559b14b4b5c41b2ae8cecefc31707e4~tplv-k3u1fbpfcp-zoom-1.image" alt=" "></p> <center>endTag</center>
é™¤äº†ä¸Šé¢å…³äºæ ‡ç­¾å¼€å§‹å’Œç»“æŸçš„æ­£åˆ™ï¼Œè¿˜æœ‰ä¸€æ®µç”¨æ¥æå–æ ‡ç­¾å±æ€§çš„æ­£åˆ™ï¼ŒçœŸçš„æ˜¯åˆè‡­åˆé•¿ã€‚
<div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> attribute <span class="token operator">=</span>
  <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\s*([^\s&quot;'&lt;&gt;\/=]+)(?:\s*(=)\s*(?:&quot;([^&quot;]*)&quot;+|'([^']\*)'+|([^\s&quot;'=&lt;&gt;`]+)))?</span><span class="token regex-delimiter">/</span></span>
</code></pre></div><p>æŠŠæ­£åˆ™æ”¾åˆ°å·¥å…·ä¸Šå°±ä¸€ç›®äº†ç„¶äº†ï¼Œä»¥ <code>=</code> ä¸ºåˆ†ç•Œï¼Œå‰é¢ä¸ºå±æ€§çš„åå­—ï¼Œåé¢ä¸ºå±æ€§çš„å€¼ã€‚</p> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/be4eae650df94781b88d3dc0d199a9ab~tplv-k3u1fbpfcp-zoom-1.image" alt=" "></p> <center>attribute</center>
ç†æ¸…æ­£åˆ™åå¯ä»¥æ›´åŠ æ–¹ä¾¿æˆ‘ä»¬çœ‹åé¢çš„ä»£ç ã€‚
<div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">while</span> <span class="token punctuation">(</span>html<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  last <span class="token operator">=</span> html
  <span class="token keyword">let</span> textEnd <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'&lt;'</span><span class="token punctuation">)</span>

  <span class="token comment">// &quot;&lt;&quot; å­—ç¬¦åœ¨å½“å‰ html å­—ç¬¦ä¸²å¼€å§‹ä½ç½®</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>textEnd <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// some code ...</span>

    <span class="token comment">// 4ã€åŒ¹é…åˆ°æ ‡ç­¾ç»“æŸä½ç½®: &lt;/div&gt;</span>
    <span class="token keyword">const</span> endTagMatch <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>endTag<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>endTagMatch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> curIndex <span class="token operator">=</span> index
      <span class="token function">advance</span><span class="token punctuation">(</span>endTagMatch<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span>
      <span class="token function">parseEndTag</span><span class="token punctuation">(</span>endTagMatch<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> curIndex<span class="token punctuation">,</span> index<span class="token punctuation">)</span>
      <span class="token keyword">continue</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 5ã€åŒ¹é…åˆ°æ ‡ç­¾å¼€å§‹ä½ç½®: &lt;div&gt;</span>
    <span class="token keyword">const</span> startTagMatch <span class="token operator">=</span> <span class="token function">parseStartTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>startTagMatch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">handleStartTag</span><span class="token punctuation">(</span>startTagMatch<span class="token punctuation">)</span>
      <span class="token keyword">continue</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// å‘å‰æ¨è¿›ï¼Œè£åˆ‡ html</span>
<span class="token keyword">function</span> <span class="token function">advance</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  index <span class="token operator">+=</span> n
  html <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// åˆ¤æ–­æ˜¯å¦æ ‡ç­¾å¼€å§‹ä½ç½®ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™æå–æ ‡ç­¾åä»¥åŠç›¸å…³å±æ€§</span>
<span class="token keyword">function</span> <span class="token function">parseStartTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// æå– &lt;xxx</span>
  <span class="token keyword">const</span> start <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>startTagOpen<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>start<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>fullStr<span class="token punctuation">,</span> tag<span class="token punctuation">]</span> <span class="token operator">=</span> start
    <span class="token keyword">const</span> match <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">attrs</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">start</span><span class="token operator">:</span> index<span class="token punctuation">,</span>
      <span class="token literal-property property">tagName</span><span class="token operator">:</span> tag<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token function">advance</span><span class="token punctuation">(</span>fullStr<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
    <span class="token keyword">let</span> end<span class="token punctuation">,</span> attr
    <span class="token comment">// é€’å½’æå–å±æ€§ï¼Œç›´åˆ°å‡ºç° &quot;&gt;&quot; æˆ– &quot;/&gt;&quot; å­—ç¬¦</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>
      <span class="token operator">!</span><span class="token punctuation">(</span>end <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>startTagClose<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
      <span class="token punctuation">(</span>attr <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>attribute<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">advance</span><span class="token punctuation">(</span>attr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span>
      match<span class="token punctuation">.</span>attrs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>attr<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>end<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// å¦‚æœæ˜¯ &quot;/&gt;&quot; è¡¨ç¤ºå•æ ‡ç­¾</span>
      match<span class="token punctuation">.</span>unarySlash <span class="token operator">=</span> end<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
      <span class="token function">advance</span><span class="token punctuation">(</span>end<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span>
      match<span class="token punctuation">.</span>end <span class="token operator">=</span> index
      <span class="token keyword">return</span> match
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// å¤„ç†å¼€å§‹æ ‡ç­¾</span>
<span class="token keyword">function</span> <span class="token function">handleStartTag</span><span class="token punctuation">(</span><span class="token parameter">match</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> tagName <span class="token operator">=</span> match<span class="token punctuation">.</span>tagName
  <span class="token keyword">const</span> unary <span class="token operator">=</span> match<span class="token punctuation">.</span>unarySlash
  <span class="token keyword">const</span> len <span class="token operator">=</span> match<span class="token punctuation">.</span>attrs<span class="token punctuation">.</span>length
  <span class="token keyword">const</span> attrs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>len<span class="token punctuation">)</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> args <span class="token operator">=</span> match<span class="token punctuation">.</span>attrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    <span class="token comment">// è¿™é‡Œçš„ 3ã€4ã€5 åˆ†åˆ«å¯¹åº”ä¸‰ç§ä¸åŒå¤åˆ¶å±æ€§çš„æ–¹å¼</span>
    <span class="token comment">// 3: attr=&quot;xxx&quot; åŒå¼•å·</span>
    <span class="token comment">// 4: attr='xxx' å•å¼•å·</span>
    <span class="token comment">// 5: attr=xxx çœç•¥å¼•å·</span>
    <span class="token keyword">const</span> value <span class="token operator">=</span> args<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">||</span> args<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">||</span> args<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token string">''</span>
    attrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      value<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>unary<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// éå•æ ‡ç­¾ï¼Œå…¥æ ˆ</span>
    stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">tag</span><span class="token operator">:</span> tagName<span class="token punctuation">,</span>
      <span class="token literal-property property">lowerCasedTag</span><span class="token operator">:</span> tagName<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">attrs</span><span class="token operator">:</span> attrs<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    lastTag <span class="token operator">=</span> tagName
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>start<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¼€å§‹æ ‡ç­¾çš„å›è°ƒ</span>
    options<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>tagName<span class="token punctuation">,</span> attrs<span class="token punctuation">,</span> unary<span class="token punctuation">,</span> match<span class="token punctuation">.</span>start<span class="token punctuation">,</span> match<span class="token punctuation">.</span>end<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// å¤„ç†é—­åˆæ ‡ç­¾</span>
<span class="token keyword">function</span> <span class="token function">parseEndTag</span><span class="token punctuation">(</span><span class="token parameter">tagName<span class="token punctuation">,</span> start<span class="token punctuation">,</span> end</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> pos<span class="token punctuation">,</span> lowerCasedTagName
  <span class="token keyword">if</span> <span class="token punctuation">(</span>start <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> start <span class="token operator">=</span> index
  <span class="token keyword">if</span> <span class="token punctuation">(</span>end <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> end <span class="token operator">=</span> index

  <span class="token keyword">if</span> <span class="token punctuation">(</span>tagName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    lowerCasedTagName <span class="token operator">=</span> tagName<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// åœ¨æ ˆå†…æŸ¥æ‰¾ç›¸åŒç±»å‹çš„æœªé—­åˆæ ‡ç­¾</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>tagName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>pos <span class="token operator">=</span> stack<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> pos <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> pos<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>stack<span class="token punctuation">[</span>pos<span class="token punctuation">]</span><span class="token punctuation">.</span>lowerCasedTag <span class="token operator">===</span> lowerCasedTagName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">break</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    pos <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>pos <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å…³é—­è¯¥æ ‡ç­¾å†…çš„æœªé—­åˆæ ‡ç­¾ï¼Œæ›´æ–°å †æ ˆ</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> stack<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> pos<span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>end<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// end å›è°ƒ</span>
        options<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>stack<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>tag<span class="token punctuation">,</span> start<span class="token punctuation">,</span> end<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// å †æ ˆä¸­åˆ é™¤å·²å…³é—­æ ‡ç­¾</span>
    stack<span class="token punctuation">.</span>length <span class="token operator">=</span> pos
    lastTag <span class="token operator">=</span> pos <span class="token operator">&amp;&amp;</span> stack<span class="token punctuation">[</span>pos <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>tag
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>åœ¨è§£æå¼€å§‹æ ‡ç­¾çš„æ—¶å€™ï¼Œå¦‚æœè¯¥æ ‡ç­¾ä¸æ˜¯å•æ ‡ç­¾ï¼Œä¼šå°†è¯¥æ ‡ç­¾æ”¾å…¥åˆ°ä¸€ä¸ªå †æ ˆå½“ä¸­ï¼Œæ¯æ¬¡é—­åˆæ ‡ç­¾çš„æ—¶å€™ï¼Œä¼šä»æ ˆé¡¶å‘ä¸‹æŸ¥æ‰¾åŒåæ ‡ç­¾ï¼Œç›´åˆ°æ‰¾åˆ°åŒåæ ‡ç­¾ï¼Œè¿™ä¸ªæ“ä½œä¼šé—­åˆåŒåæ ‡ç­¾ä¸Šé¢çš„æ‰€æœ‰æ ‡ç­¾ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ä¸¾ä¸ªä¾‹å­ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>test<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</code></pre></div><p>åœ¨è§£æäº† div å’Œ h2 çš„å¼€å§‹æ ‡ç­¾åï¼Œæ ˆå†…å°±å­˜åœ¨äº†ä¸¤ä¸ªå…ƒç´ ã€‚h2 é—­åˆåï¼Œå°±ä¼šå°† h2 å‡ºæ ˆã€‚ç„¶åä¼šè§£æä¸¤ä¸ªæœªé—­åˆçš„ p æ ‡ç­¾ï¼Œæ­¤æ—¶ï¼Œæ ˆå†…å­˜åœ¨ä¸‰ä¸ªå…ƒç´ ï¼ˆdivã€pã€pï¼‰ã€‚å¦‚æœè¿™ä¸ªæ—¶å€™ï¼Œè§£æäº† div çš„é—­åˆæ ‡ç­¾ï¼Œé™¤äº†å°† div é—­åˆå¤–ï¼Œdiv å†…ä¸¤ä¸ªæœªé—­åˆçš„ p æ ‡ç­¾ä¹Ÿä¼šè·Ÿéšé—­åˆï¼Œæ­¤æ—¶æ ˆè¢«æ¸…ç©ºã€‚</p> <p>ä¸ºäº†ä¾¿äºç†è§£ï¼Œç‰¹åœ°å½•åˆ¶äº†ä¸€ä¸ªåŠ¨å›¾ï¼Œå¦‚ä¸‹ï¼š</p> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a7ed0d4fd8d44f0fadfcd437b89732d4~tplv-k3u1fbpfcp-zoom-1.image" alt=" "></p> <center>å…¥æ ˆä¸å‡ºæ ˆ</center>
ç†æ¸…äº† parseHTML çš„é€»è¾‘åï¼Œæˆ‘ä»¬å›åˆ°è°ƒç”¨ parseHTML çš„ä½ç½®ï¼Œè°ƒç”¨è¯¥æ–¹æ³•çš„æ—¶å€™ï¼Œä¸€å…±ä¼šä¼ å…¥å››ä¸ªå›è°ƒï¼Œåˆ†åˆ«å¯¹åº”æ ‡ç­¾çš„å¼€å§‹å’Œç»“æŸã€æ–‡æœ¬ã€æ³¨é‡Šã€‚
<div class="language-js extra-class"><pre class="language-js"><code><span class="token function">parseHTML</span><span class="token punctuation">(</span>template<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token comment">// some options...</span>

  <span class="token comment">// è§£æåˆ°æ ‡ç­¾ä½ç½®å¼€å§‹çš„å›è°ƒ</span>
  <span class="token function">start</span><span class="token punctuation">(</span><span class="token parameter">tag<span class="token punctuation">,</span> attrs<span class="token punctuation">,</span> unary</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// è§£æåˆ°æ ‡ç­¾ä½ç½®ç»“æŸçš„å›è°ƒ</span>
  <span class="token function">end</span><span class="token punctuation">(</span><span class="token parameter">tag</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// è§£æåˆ°æ–‡æœ¬æ—¶çš„å›è°ƒ</span>
  <span class="token function">chars</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">text</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// è§£æåˆ°æ³¨é‡Šæ—¶çš„å›è°ƒ</span>
  <span class="token function">comment</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">text</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="å¤„ç†å¼€å§‹æ ‡ç­¾"><a href="#å¤„ç†å¼€å§‹æ ‡ç­¾" class="header-anchor">#</a> å¤„ç†å¼€å§‹æ ‡ç­¾</h3> <p>é¦–å…ˆçœ‹è§£æåˆ°å¼€å§‹æ ‡ç­¾æ—¶ï¼Œä¼šç”Ÿæˆä¸€ä¸ª AST èŠ‚ç‚¹ï¼Œç„¶åå¤„ç†æ ‡ç­¾ä¸Šçš„å±æ€§ï¼Œæœ€åå°† AST èŠ‚ç‚¹æ”¾å…¥æ ‘å½¢ç»“æ„ä¸­ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">makeAttrsMap</span><span class="token punctuation">(</span><span class="token parameter">attrs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> map <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> attrs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> value <span class="token punctuation">}</span> <span class="token operator">=</span> attrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    map<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> value
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> map
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">createASTElement</span><span class="token punctuation">(</span><span class="token parameter">tag<span class="token punctuation">,</span> attrs<span class="token punctuation">,</span> parent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> attrsList <span class="token operator">=</span> attrs
  <span class="token keyword">const</span> attrsMap <span class="token operator">=</span> <span class="token function">makeAttrsMap</span><span class="token punctuation">(</span>attrsList<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// èŠ‚ç‚¹ç±»å‹</span>
    tag<span class="token punctuation">,</span> <span class="token comment">// èŠ‚ç‚¹åç§°</span>
    attrsMap<span class="token punctuation">,</span> <span class="token comment">// èŠ‚ç‚¹å±æ€§æ˜ å°„</span>
    attrsList<span class="token punctuation">,</span> <span class="token comment">// èŠ‚ç‚¹å±æ€§æ•°ç»„</span>
    parent<span class="token punctuation">,</span> <span class="token comment">// çˆ¶èŠ‚ç‚¹</span>
    <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// å­èŠ‚ç‚¹</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> root <span class="token comment">// æ ¹èŠ‚ç‚¹</span>
<span class="token keyword">let</span> currentParent <span class="token comment">// æš‚å­˜å½“å‰çš„çˆ¶èŠ‚ç‚¹</span>
<span class="token function">parseHTML</span><span class="token punctuation">(</span>template<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token comment">// some options...</span>

  <span class="token comment">// è§£æåˆ°æ ‡ç­¾ä½ç½®å¼€å§‹çš„å›è°ƒ</span>
  <span class="token function">start</span><span class="token punctuation">(</span><span class="token parameter">tag<span class="token punctuation">,</span> attrs<span class="token punctuation">,</span> unary</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// åˆ›å»º AST èŠ‚ç‚¹</span>
    <span class="token keyword">let</span> element <span class="token operator">=</span> <span class="token function">createASTElement</span><span class="token punctuation">(</span>tag<span class="token punctuation">,</span> attrs<span class="token punctuation">,</span> currentParent<span class="token punctuation">)</span>

    <span class="token comment">// å¤„ç†æŒ‡ä»¤: v-for v-if v-once</span>
    <span class="token function">processFor</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span>
    <span class="token function">processIf</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span>
    <span class="token function">processOnce</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span>
    <span class="token function">processElement</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> options<span class="token punctuation">)</span>

    <span class="token comment">// å¤„ç† AST æ ‘</span>
    <span class="token comment">// æ ¹èŠ‚ç‚¹ä¸å­˜åœ¨ï¼Œåˆ™è®¾ç½®è¯¥å…ƒç´ ä¸ºæ ¹èŠ‚ç‚¹</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>root<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      root <span class="token operator">=</span> element
      <span class="token function">checkRootConstraints</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// å­˜åœ¨çˆ¶èŠ‚ç‚¹</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>currentParent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// å°†è¯¥å…ƒç´ æ¨å…¥çˆ¶èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ä¸­</span>
      currentParent<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span>
      element<span class="token punctuation">.</span>parent <span class="token operator">=</span> currentParent
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>unary<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// éå•æ ‡ç­¾éœ€è¦å…¥æ ˆï¼Œä¸”åˆ‡æ¢å½“å‰çˆ¶å…ƒç´ çš„ä½ç½®</span>
      currentParent <span class="token operator">=</span> element
      stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="å¤„ç†ç»“æŸæ ‡ç­¾"><a href="#å¤„ç†ç»“æŸæ ‡ç­¾" class="header-anchor">#</a> å¤„ç†ç»“æŸæ ‡ç­¾</h3> <p>æ ‡ç­¾ç»“æŸçš„é€»è¾‘å°±æ¯”è¾ƒç®€å•äº†ï¼Œåªéœ€è¦å»é™¤æ ˆå†…æœ€åä¸€ä¸ªæœªé—­åˆæ ‡ç­¾ï¼Œè¿›è¡Œé—­åˆå³å¯ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">parseHTML</span><span class="token punctuation">(</span>template<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token comment">// some options...</span>

  <span class="token comment">// è§£æåˆ°æ ‡ç­¾ä½ç½®ç»“æŸçš„å›è°ƒ</span>
  <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> element <span class="token operator">=</span> stack<span class="token punctuation">[</span>stack<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">const</span> lastNode <span class="token operator">=</span> element<span class="token punctuation">.</span>children<span class="token punctuation">[</span>element<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token comment">// å¤„ç†å°¾éƒ¨ç©ºæ ¼çš„æƒ…å†µ</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>lastNode <span class="token operator">&amp;&amp;</span> lastNode<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token number">3</span> <span class="token operator">&amp;&amp;</span> lastNode<span class="token punctuation">.</span>text <span class="token operator">===</span> <span class="token string">' '</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      element<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// å‡ºæ ˆï¼Œé‡ç½®å½“å‰çš„çˆ¶èŠ‚ç‚¹</span>
    stack<span class="token punctuation">.</span>length <span class="token operator">-=</span> <span class="token number">1</span>
    currentParent <span class="token operator">=</span> stack<span class="token punctuation">[</span>stack<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="å¤„ç†æ–‡æœ¬"><a href="#å¤„ç†æ–‡æœ¬" class="header-anchor">#</a> å¤„ç†æ–‡æœ¬</h3> <p>å¤„ç†å®Œæ ‡ç­¾åï¼Œè¿˜éœ€è¦å¯¹æ ‡ç­¾å†…çš„æ–‡æœ¬è¿›è¡Œå¤„ç†ã€‚æ–‡æœ¬çš„å¤„ç†åˆ†ä¸¤ç§æƒ…å†µï¼Œä¸€ç§æ˜¯å¸¦è¡¨è¾¾å¼çš„æ–‡æœ¬ï¼Œè¿˜ä¸€ç§å°±æ˜¯çº¯é™æ€çš„æ–‡æœ¬ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">parseHTML</span><span class="token punctuation">(</span>template<span class="token punctuation">,</span> <span class="token punctuation">{</span>
<span class="token comment">// some options...</span>

<span class="token comment">// è§£æåˆ°æ–‡æœ¬æ—¶çš„å›è°ƒ</span>
<span class="token function">chars</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>currentParent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">// æ–‡æœ¬èŠ‚ç‚¹å¤–å¦‚æœæ²¡æœ‰çˆ¶èŠ‚ç‚¹åˆ™ä¸å¤„ç†</span>
<span class="token keyword">return</span>
<span class="token punctuation">}</span>

    <span class="token keyword">const</span> children <span class="token operator">=</span> currentParent<span class="token punctuation">.</span>children
    text <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// parseText ç”¨æ¥è§£æè¡¨è¾¾å¼</span>
      <span class="token comment">// delimiters è¡¨ç¤ºè¡¨è¾¾å¼æ ‡è¯†ç¬¦ï¼Œé»˜è®¤ä¸º ['{{', '}}']</span>
      <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token function">parseText</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> delimiters<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// è¡¨è¾¾å¼</span>
        children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
          <span class="token literal-property property">expression</span><span class="token operator">:</span> res<span class="token punctuation">.</span>expression<span class="token punctuation">,</span>
          <span class="token literal-property property">tokens</span><span class="token operator">:</span> res<span class="token punctuation">.</span>tokens<span class="token punctuation">,</span>
          text
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// é™æ€æ–‡æœ¬</span>
        children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
          text
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>ä¸‹é¢æˆ‘ä»¬çœ‹çœ‹ parseText å¦‚ä½•è§£æè¡¨è¾¾å¼ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// æ„é€ åŒ¹é…è¡¨è¾¾å¼çš„æ­£åˆ™</span>
<span class="token keyword">const</span> <span class="token function-variable function">buildRegex</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">delimiters</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> open <span class="token operator">=</span> delimiters<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  <span class="token keyword">const</span> close <span class="token operator">=</span> delimiters<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>open <span class="token operator">+</span> <span class="token string">'((?:.|\\n)+?)'</span> <span class="token operator">+</span> close<span class="token punctuation">,</span> <span class="token string">'g'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">parseText</span><span class="token punctuation">(</span><span class="token parameter">text<span class="token punctuation">,</span> delimiters</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// delimiters é»˜è®¤ä¸º {{ }}</span>
  <span class="token keyword">const</span> tagRE <span class="token operator">=</span> <span class="token function">buildRegex</span><span class="token punctuation">(</span>delimiters <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token string">'{{'</span><span class="token punctuation">,</span> <span class="token string">'}}'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token comment">// æœªåŒ¹é…åˆ°è¡¨è¾¾å¼ï¼Œç›´æ¥è¿”å›</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>tagRE<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> tokens <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">const</span> rawTokens <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">let</span> lastIndex <span class="token operator">=</span> <span class="token punctuation">(</span>tagRE<span class="token punctuation">.</span>lastIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> match<span class="token punctuation">,</span> index<span class="token punctuation">,</span> tokenValue
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>match <span class="token operator">=</span> tagRE<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// è¡¨è¾¾å¼å¼€å§‹çš„ä½ç½®</span>
    index <span class="token operator">=</span> match<span class="token punctuation">.</span>index
    <span class="token comment">// æå–è¡¨è¾¾å¼å¼€å§‹ä½ç½®å‰é¢çš„é™æ€å­—ç¬¦ï¼Œæ”¾å…¥ token ä¸­</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&gt;</span> lastIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      rawTokens<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span>tokenValue <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>lastIndex<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      tokens<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>tokenValue<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// æå–è¡¨è¾¾å¼å†…éƒ¨çš„å†…å®¹ï¼Œä½¿ç”¨ \_s() æ–¹æ³•åŒ…è£¹</span>
    <span class="token keyword">const</span> exp <span class="token operator">=</span> match<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    tokens<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_s(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>exp<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    rawTokens<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string-property property">'@binding'</span><span class="token operator">:</span> exp <span class="token punctuation">}</span><span class="token punctuation">)</span>
    lastIndex <span class="token operator">=</span> index <span class="token operator">+</span> match<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length
  <span class="token punctuation">}</span>
  <span class="token comment">// è¡¨è¾¾å¼åé¢è¿˜æœ‰å…¶ä»–é™æ€å­—ç¬¦ï¼Œæ”¾å…¥ token ä¸­</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>lastIndex <span class="token operator">&lt;</span> text<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    rawTokens<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span>tokenValue <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>lastIndex<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    tokens<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>tokenValue<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">expression</span><span class="token operator">:</span> tokens<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'+'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">tokens</span><span class="token operator">:</span> rawTokens<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>é¦–å…ˆé€šè¿‡ä¸€æ®µæ­£åˆ™æ¥æå–è¡¨è¾¾å¼ï¼š</p> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9ae50035f5274338a2a94e3791bd9b98~tplv-k3u1fbpfcp-zoom-1.image" alt=" "></p> <center>æå–è¡¨è¾¾å¼</center>
çœ‹ä»£ç å¯èƒ½æœ‰ç‚¹éš¾ï¼Œæˆ‘ä»¬ç›´æ¥çœ‹ä¾‹å­ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªåŒ…å«è¡¨è¾¾å¼çš„æ–‡æœ¬ã€‚
<div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>æ˜¯å¦ç™»å½•ï¼š<span class="token punctuation">{</span><span class="token punctuation">{</span>isLogin <span class="token operator">?</span> <span class="token string">'æ˜¯'</span> <span class="token operator">:</span> <span class="token string">'å¦'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</code></pre></div><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/79c4f2d9158f40eeb1113876647f1bef~tplv-k3u1fbpfcp-zoom-1.image" alt=" "></p> <center>è¿è¡Œç»“æœ</center> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d893b9105db9422782e300f46ccd10dd~tplv-k3u1fbpfcp-zoom-1.image" alt=" "></p> <center>è§£ææ–‡æœ¬</center> <h3 id="optimize"><a href="#optimize" class="header-anchor">#</a> optimize</h3> <p>é€šè¿‡ä¸Šè¿°ä¸€äº›åˆ—å¤„ç†ï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº† Vue æ¨¡æ¿çš„ ASTã€‚ç”±äº Vue æ˜¯å“åº”å¼è®¾è®¡ï¼Œæ‰€ä»¥æ‹¿åˆ° AST ä¹‹åè¿˜éœ€è¦è¿›è¡Œä¸€ç³»åˆ—ä¼˜åŒ–ï¼Œç¡®ä¿é™æ€çš„æ•°æ®ä¸ä¼šè¿›å…¥è™šæ‹Ÿ DOM çš„æ›´æ–°é˜¶æ®µï¼Œä»¥æ­¤æ¥ä¼˜åŒ–æ€§èƒ½ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">optimize</span><span class="token punctuation">(</span><span class="token parameter">root<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>root<span class="token punctuation">)</span> <span class="token keyword">return</span>
  <span class="token comment">// æ ‡è®°é™æ€èŠ‚ç‚¹</span>
  <span class="token function">markStatic</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æŠŠæ‰€ä»¥é™æ€èŠ‚ç‚¹çš„ static å±æ€§è®¾ç½®ä¸º trueã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">isStatic</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// è¡¨è¾¾å¼ï¼Œè¿”å› false</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// é™æ€æ–‡æœ¬ï¼Œè¿”å› true</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// æ­¤å¤„çœç•¥äº†éƒ¨åˆ†æ¡ä»¶</span>
  <span class="token keyword">return</span> <span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span>
      <span class="token operator">!</span>node<span class="token punctuation">.</span>hasBindings <span class="token operator">&amp;&amp;</span> <span class="token comment">// æ²¡æœ‰åŠ¨æ€ç»‘å®š</span>
      <span class="token operator">!</span>node<span class="token punctuation">.</span>if <span class="token operator">&amp;&amp;</span>
      <span class="token operator">!</span>node<span class="token punctuation">.</span>for <span class="token operator">&amp;&amp;</span> <span class="token comment">// æ²¡æœ‰ v-if/v-for</span>
      <span class="token operator">!</span><span class="token function">isBuiltInTag</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>tag<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token comment">// ä¸æ˜¯å†…ç½®ç»„ä»¶ slot/component</span>
      <span class="token operator">!</span><span class="token function">isDirectChildOfTemplateFor</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token comment">// ä¸åœ¨ template for å¾ªç¯å†…</span>
      Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span>isStaticKey<span class="token punctuation">)</span>
    <span class="token punctuation">)</span> <span class="token comment">// éé™æ€èŠ‚ç‚¹</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">markStatic</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  node<span class="token punctuation">.</span>static <span class="token operator">=</span> <span class="token function">isStatic</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœæ˜¯å…ƒç´ èŠ‚ç‚¹ï¼Œéœ€è¦éå†æ‰€æœ‰å­èŠ‚ç‚¹</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> node<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> child <span class="token operator">=</span> node<span class="token punctuation">.</span>children<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
      <span class="token function">markStatic</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>child<span class="token punctuation">.</span>static<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å¦‚æœæœ‰ä¸€ä¸ªå­èŠ‚ç‚¹ä¸æ˜¯é™æ€èŠ‚ç‚¹ï¼Œåˆ™è¯¥èŠ‚ç‚¹ä¹Ÿå¿…é¡»æ˜¯åŠ¨æ€çš„</span>
        node<span class="token punctuation">.</span>static <span class="token operator">=</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="generate"><a href="#generate" class="header-anchor">#</a> generate</h3> <p>å¾—åˆ°ä¼˜åŒ–çš„ AST ä¹‹åï¼Œå°±éœ€è¦å°† AST è½¬åŒ–ä¸º render æ–¹æ³•ã€‚è¿˜æ˜¯ç”¨ä¹‹å‰çš„æ¨¡æ¿ï¼Œå…ˆçœ‹çœ‹ç”Ÿæˆçš„ä»£ç é•¿ä»€ä¹ˆæ ·ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>h2 v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;message&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>message<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">&quot;showName&quot;</span><span class="token operator">&gt;</span>showName<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
<span class="token literal-property property">render</span><span class="token operator">:</span> <span class="token string">&quot;with(this){return \_c('div',[(message)?\_c('h2',[_v(_s(message))]):\_e(),\_v(&quot;</span> <span class="token string">&quot;),\_c('button',{on:{&quot;</span>click<span class="token string">&quot;:showName}},[_v(&quot;</span>showName<span class="token string">&quot;)])])}&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å°†ç”Ÿæˆçš„ä»£ç å±•å¼€ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">with</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> \<span class="token function">_c</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    message <span class="token operator">?</span> \<span class="token function">_c</span><span class="token punctuation">(</span><span class="token string">'h2'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token function">_v</span><span class="token punctuation">(</span><span class="token function">_s</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">:</span> \<span class="token function">_e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    \<span class="token function">_v</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    \<span class="token function">_c</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">on</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">click</span><span class="token operator">:</span> showName <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token function">_v</span><span class="token punctuation">(</span><span class="token string">'showName'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>çœ‹åˆ°è¿™é‡Œä¸€å †çš„ä¸‹åˆ’çº¿è‚¯å®šå¾ˆæ‡µé€¼ï¼Œè¿™é‡Œçš„ <code>_c</code> å¯¹åº”çš„æ˜¯è™šæ‹Ÿ DOM ä¸­çš„ <code>createElement</code> æ–¹æ³•ã€‚å…¶ä»–çš„ä¸‹åˆ’çº¿æ–¹æ³•åœ¨ <code>core/instance/render-helpers</code> ä¸­éƒ½æœ‰å®šä¹‰ï¼Œæ¯ä¸ªæ–¹æ³•å…·ä½“åšäº†ä»€ä¹ˆä¸åšå±•å¼€ã€‚</p> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dd96409bc9ad4a1c973d51d3134ad439~tplv-k3u1fbpfcp-zoom-1.image" alt=" "></p> <center>render-helpers</center> <p>å…·ä½“è½¬åŒ–æ–¹æ³•å°±æ˜¯ä¸€äº›ç®€å•çš„å­—ç¬¦æ‹¼æ¥ï¼Œä¸‹é¢æ˜¯ç®€åŒ–äº†é€»è¾‘çš„éƒ¨åˆ†ï¼Œä¸åšè¿‡å¤šè®²è¿°ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">generate</span><span class="token punctuation">(</span><span class="token parameter">ast<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CodegenState</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
  <span class="token keyword">const</span> code <span class="token operator">=</span> ast <span class="token operator">?</span> <span class="token function">genElement</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> state<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">'_c(&quot;div&quot;)'</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">render</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">with(this){return </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>code<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">}</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token literal-property property">staticRenderFns</span><span class="token operator">:</span> state<span class="token punctuation">.</span>staticRenderFns<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">genElement</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> code
  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token function">genData</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> state<span class="token punctuation">)</span>
  <span class="token keyword">const</span> children <span class="token operator">=</span> <span class="token function">genChildren</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> state<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
  code <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_c('</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>el<span class="token punctuation">.</span>tag<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">'</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>
    data <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">''</span> <span class="token comment">// data</span>
  <span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>
    children <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>children<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">''</span> <span class="token comment">// children</span>
  <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span>
  <span class="token keyword">return</span> code
<span class="token punctuation">}</span>
</code></pre></div><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="header-anchor">#</a> æ€»ç»“</h2> <p>ç†æ¸…äº† Vue æ¨¡æ¿ç¼–è¯‘çš„æ•´ä¸ªè¿‡ç¨‹ï¼Œé‡ç‚¹éƒ½æ”¾åœ¨äº†è§£æ HTML ç”Ÿæˆ AST çš„éƒ¨åˆ†ã€‚æœ¬æ–‡åªæ˜¯å¤§è‡´è®²è¿°äº†ä¸»è¦æµç¨‹ï¼Œå…¶ä¸­çœç•¥äº†ç‰¹åˆ«å¤šçš„ç»†èŠ‚ï¼Œæ¯”å¦‚ï¼šå¯¹ template/slot çš„å¤„ç†ã€æŒ‡ä»¤çš„å¤„ç†ç­‰ç­‰ï¼Œå¦‚æœæƒ³äº†è§£å…¶ä¸­çš„ç»†èŠ‚å¯ä»¥ç›´æ¥é˜…è¯»æºç ã€‚å¸Œæœ›å¤§å®¶åœ¨é˜…è¯»è¿™ç¯‡æ–‡ç« åæœ‰æ‰€æ”¶è·ã€‚</p></div></section> <footer class="page-edit"><!----> <!----></footer> <!----> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-5ecb72e8><li class="level-2" data-v-5ecb72e8><a href="/xifan052/docs/%E6%BA%90%E7%A0%81/vue%E6%A8%A1%E6%9D%BF%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86.html#å†™åœ¨å¼€å¤´" class="sidebar-link reco-side-å†™åœ¨å¼€å¤´" data-v-5ecb72e8>å†™åœ¨å¼€å¤´</a></li><li class="level-2" data-v-5ecb72e8><a href="/xifan052/docs/%E6%BA%90%E7%A0%81/vue%E6%A8%A1%E6%9D%BF%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86.html#vue-çš„ç‰ˆæœ¬" class="sidebar-link reco-side-vue-çš„ç‰ˆæœ¬" data-v-5ecb72e8>Vue çš„ç‰ˆæœ¬</a></li><li class="level-2" data-v-5ecb72e8><a href="/xifan052/docs/%E6%BA%90%E7%A0%81/vue%E6%A8%A1%E6%9D%BF%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86.html#ç¼–è¯‘å…¥å£" class="sidebar-link reco-side-ç¼–è¯‘å…¥å£" data-v-5ecb72e8>ç¼–è¯‘å…¥å£</a></li><li class="level-2" data-v-5ecb72e8><a href="/xifan052/docs/%E6%BA%90%E7%A0%81/vue%E6%A8%A1%E6%9D%BF%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86.html#ä¸»æµç¨‹" class="sidebar-link reco-side-ä¸»æµç¨‹" data-v-5ecb72e8>ä¸»æµç¨‹</a></li><li class="level-3" data-v-5ecb72e8><a href="/xifan052/docs/%E6%BA%90%E7%A0%81/vue%E6%A8%A1%E6%9D%BF%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86.html#parse" class="sidebar-link reco-side-parse" data-v-5ecb72e8>parse</a></li><li class="level-3" data-v-5ecb72e8><a href="/xifan052/docs/%E6%BA%90%E7%A0%81/vue%E6%A8%A1%E6%9D%BF%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86.html#ast" class="sidebar-link reco-side-ast" data-v-5ecb72e8>AST</a></li><li class="level-3" data-v-5ecb72e8><a href="/xifan052/docs/%E6%BA%90%E7%A0%81/vue%E6%A8%A1%E6%9D%BF%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86.html#è§£æ-html" class="sidebar-link reco-side-è§£æ-html" data-v-5ecb72e8>è§£æ HTML</a></li><li class="level-3" data-v-5ecb72e8><a href="/xifan052/docs/%E6%BA%90%E7%A0%81/vue%E6%A8%A1%E6%9D%BF%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86.html#å¤„ç†å¼€å§‹æ ‡ç­¾" class="sidebar-link reco-side-å¤„ç†å¼€å§‹æ ‡ç­¾" data-v-5ecb72e8>å¤„ç†å¼€å§‹æ ‡ç­¾</a></li><li class="level-3" data-v-5ecb72e8><a href="/xifan052/docs/%E6%BA%90%E7%A0%81/vue%E6%A8%A1%E6%9D%BF%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86.html#å¤„ç†ç»“æŸæ ‡ç­¾" class="sidebar-link reco-side-å¤„ç†ç»“æŸæ ‡ç­¾" data-v-5ecb72e8>å¤„ç†ç»“æŸæ ‡ç­¾</a></li><li class="level-3" data-v-5ecb72e8><a href="/xifan052/docs/%E6%BA%90%E7%A0%81/vue%E6%A8%A1%E6%9D%BF%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86.html#å¤„ç†æ–‡æœ¬" class="sidebar-link reco-side-å¤„ç†æ–‡æœ¬" data-v-5ecb72e8>å¤„ç†æ–‡æœ¬</a></li><li class="level-3" data-v-5ecb72e8><a href="/xifan052/docs/%E6%BA%90%E7%A0%81/vue%E6%A8%A1%E6%9D%BF%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86.html#optimize" class="sidebar-link reco-side-optimize" data-v-5ecb72e8>optimize</a></li><li class="level-3" data-v-5ecb72e8><a href="/xifan052/docs/%E6%BA%90%E7%A0%81/vue%E6%A8%A1%E6%9D%BF%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86.html#generate" class="sidebar-link reco-side-generate" data-v-5ecb72e8>generate</a></li><li class="level-2" data-v-5ecb72e8><a href="/xifan052/docs/%E6%BA%90%E7%A0%81/vue%E6%A8%A1%E6%9D%BF%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86.html#æ€»ç»“" class="sidebar-link reco-side-æ€»ç»“" data-v-5ecb72e8>æ€»ç»“</a></li></ul></main></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/xifan052/assets/js/app.4adfbbdc.js" defer></script><script src="/xifan052/assets/js/4.2ae3d6d0.js" defer></script><script src="/xifan052/assets/js/1.b6076196.js" defer></script><script src="/xifan052/assets/js/19.1bdddbfb.js" defer></script>
  </body>
</html>
